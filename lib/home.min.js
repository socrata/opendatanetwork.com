"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function delay(t){return new Promise(function(e,n){setTimeout(e,t)})}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function multiComplete(t,e){function n(t){window.location.href=t}var o="odn.data.socrata.com",a=[{name:"Datasets",domain:o,fxf:"fpum-bjbr",column:"encoded",encoded:["domain","fxf"],select:function(t){return n("http://"+t.domain+"/dataset/"+t.fxf)},show:function(t,e){t.append("span").attr("class","name").text(e.text).append("span").attr("id","tag").text(e.domain)}},{name:"Regions",domain:o,fxf:"68ht-6puw",column:"all",encoded:["id","type","population"],select:function(t){n("/"+t.text.replace(/ /g,"_"))},show:function(t,e){t.append("span").attr("class","name").text(e.text).append("span").attr("id","tag").text(e.type)},sort:function(t){return-parseFloat(t.population)}},{name:"Publishers",domain:o,fxf:"8ae5-ghum",column:"domain",select:function(t){return n("/search?domains="+t.text)}},{name:"Categories",domain:o,fxf:"864v-r7tf",column:"category",select:function(t){return n("/search?categories="+t.text)},show:function(t,e){t.append("span").attr("class","capitalize").text(e.text)}}],s=new Autosuggest(e,a);return s.listen(t),s}function regionsWithData(t,e){var n=_nameToColumn.has(t)?_nameToColumn.get(t):defaultColumn;return[_.extend({},_withDataSource,{select:e,column:n})]}$(document).ready(function(){$(".search-link").click(function(){var t=$("#q").val().trim();0===t.length?$("#q").focus():$("#form").submit()})}),Array.prototype.includes=function(t){return this.indexOf(t)>-1},String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})},String.prototype.split2=function(t){var e=this.split(t);return 1==e.length&&""===e[0]?[]:e};var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),ApiController=function(){function t(){_classCallCheck(this,t),this.categoriesUrl="/categories.json",this.childRegionsUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&$limit={1}",this.costOfLivingUrl="https://odn.data.socrata.com/resource/hpnf-gnfu.json?id={0}",this.datasetSummaryUrl="https://{0}/api/views/{1}.json",this.domainsUrl="https://api.us.socrata.com/api/catalog/v1/domains",this.earningsUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json?id={0}",this.educationUrl="https://odn.data.socrata.com/resource/uf4m-5u8r.json?id={0}",this.gdpUrl="https://odn.data.socrata.com/resource/ks2j-vhr8.json?id={0}",this.mostPopulousRegionTypeUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&child_type={1}&$limit={2}&$order=child_population desc",this.occupationsUrl="https://odn.data.socrata.com/resource/qfcm-fw3i.json?$order=occupation&id={0}",this.parentStateUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_type=state&child_id={0}",this.populationUrl="https://odn.data.socrata.com/resource/e3rd-zzmr.json?id={0}",this.similarRegionsUrl="https://socrata-peers.herokuapp.com/peers.json?id={0}&vectors={1}&n=5",this.supportedVectorsUrls="https://socrata-peers.herokuapp.com/supported.json?id={0}",this.healthDataUrls={rwjf_county_health_rankings_2015:"https://odn.data.socrata.com/resource/7ayp-utp2.json?id={0}",cdc_brfss_prevalence_2011_2013:"https://odn.data.socrata.com/resource/n4rt-3rmd.json?id={0}"}}return _createClass(t,[{key:"getCategories",value:function(){return d3.promise.json(this.categoriesUrl)}},{key:"getChildRegions",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.childRegionsUrl.format(t,e))}},{key:"getCitiesInState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(t,"place",e))}},{key:"getCostOfLivingData",value:function(t){return d3.promise.json(this.costOfLivingUrl.format(t))}},{key:"getCountiesInState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(t,"county",e))}},{key:"getDatasetSummary",value:function(t,e){return d3.promise.json(this.datasetSummaryUrl.format(t,e))}},{key:"getDomains",value:function(){return d3.promise.json(this.domainsUrl)}},{key:"getEarningsData",value:function(t){return d3.promise.json(this.earningsUrl.format(t))}},{key:"getEducationData",value:function(t){return d3.promise.json(this.educationUrl.format(t))}},{key:"getGdpData",value:function(t){return d3.promise.json(this.gdpUrl.format(t))}},{key:"getMetrosInState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(t,"msa",e))}},{key:"getOccupationsData",value:function(t){return d3.promise.json(this.occupationsUrl.format(t))}},{key:"getParentState",value:function(t){return d3.promise.json(this.parentStateUrl.format(t.id))}},{key:"getPopulationData",value:function(t){return d3.promise.json(this.populationUrl.format(t))}},{key:"getSimilarRegions",value:function(t,e){return d3.promise.json(this.similarRegionsUrl.format(t,e.join(",")))}},{key:"getSupportedVectors",value:function(t){return d3.promise.json(this.supportedVectorsUrls.format(t))}},{key:"getHealthRwjfChrData",value:function(t){return d3.promise.json(this.healthDataUrls.rwjf_county_health_rankings_2015.format(t))}}]),t}(),Constants={ROSTER_URL:"https://federal.demo.socrata.com/resource/bdeb-mf9k.json",AUTOCOMPLETE_SEPARATOR:":",AUTOCOMPLETE_URL:function(t,e,n,o){return"https://"+t+"/views/"+e+"/columns/"+n+"/suggest/"+o},AUTOCOMPLETE_WAIT_MS:150,AUTOCOMPLETE_MAX_OPTIONS:100,AUTOCOMPLETE_SHOWN_OPTIONS:5},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),RegionLookup=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"get",value:function(t){return $.getJSON(Constants.ROSTER_URL+"?"+$.param(t))}},{key:"getOne",value:function(e){function n(t){if(0===t.length)return console.warn("no regions found for params: "),console.warn(e),null;if(1===t.length)return t[0];var n=_.filter(t,function(t){return"place"===t.type});return n.length>0?n[0]:t[0]}return new Promise(function(o,a){t.get(e).then(function(t){o(n(t))},function(t){throw t})})}},{key:"byName",value:function(e){return t.getOne({name:e})}},{key:"byID",value:function(e){return t.getOne({id:e})}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),Base64=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"encode",value:function(t){return btoa(unescape(encodeURIComponent(str)))}},{key:"decode",value:function(t){return decodeURIComponent(escape(atob(t)))}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),AutosuggestSource=function(){function t(e,n,o,a,s,r,i,u){_classCallCheck(this,t),this.name=e,this.domain=n,this.fxf=o,this.column=a,this.encoded=s,this.select=r,this.show=i,this.sort=u}return _createClass(t,[{key:"get",value:function(t){var e=this;return new Promise(function(n,o){if(""===t)n([]);else{var a=Constants.AUTOCOMPLETE_URL(e.domain,e.fxf,e.column,t),s=e.sort?Constants.AUTOCOMPLETE_MAX_OPTIONS:Constants.AUTOCOMPLETE_SHOWN_OPTIONS,r={size:s},i=a+"?"+$.param(r);$.getJSON(i).then(function(t){n(t.options.map(function(t){return e.decode(t)}))},o)}})}},{key:"decode",value:function(t){if(this.encoded.length>0){var e=t.text,n=e.lastIndexOf(" "),o=e.substring(0,n),a=e.substring(n+1),s=Base64.decode(a),r=s.split(Constants.AUTOCOMPLETE_SEPARATOR);return _.extend({text:o},_.object(this.encoded,r))}return{text:t.text}}},{key:"display",value:function(t,e){var n=this;if(0===e.length)return[];this.sort&&(e=_.sortBy(e,this.sort).slice(0,Constants.AUTOCOMPLETE_SHOWN_OPTIONS));var o=t.append("div").attr("class","autocomplete-category"),a=(o.append("p").attr("class","autocomplete-title").text(this.name),o.append("div").attr("class","autocomplete-options")),s=this;return a.selectAll("li").data(e).enter().append("li").attr("class","autocomplete-option").each(function(t){s.show(d3.select(this),t)}).on("click",function(t){return n.select(t)}).on("mouseover.source",function(){d3.select(this).classed("selected hovered",!0)}).on("mouseout.source",function(){d3.select(this).classed("selected hovered",!1)})[0]}}],[{key:"fromJSON",value:function(e){var n=e.encoded||[],o=e.show||function(t,e){t.append("span").text(e.text)};return new t(e.name,e.domain,e.fxf,e.column,n,e.select,o,e.sort)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),AutosuggestResults=function(){function t(e){_classCallCheck(this,t),this.results=d3.select(e),this.options=[],this.index=-1,this.autohide()}return _createClass(t,[{key:"autohide",value:function(){var t=this;d3.select("html").on("click.results",function(){return t.hide()}),this.results.on("click.results",function(){return d3.event.stopPropagation()})}},{key:"hide",value:function(){this.results.style("display","none")}},{key:"unhide",value:function(){this.results.style("display","block")}},{key:"empty",value:function(){this.results.html("")}},{key:"display",value:function(t){var e=this;return new Promise(function(n,o){e.source.get(t).then(function(t){e.empty(),0===t.length?(e.hide(),n([])):(e.unhide(),n(e.source.display(e.results,t)))},function(t){throw t})})}},{key:"show",value:function(t,e){var n=this;this.empty();var o=t.map(function(t,o){var a=e[o];return t.display(n.results,a)});this.updateOptions(_.flatten(o)),this.unhide()}},{key:"updateOptions",value:function(t){var e=this;this.options=t.map(function(t){return d3.select(t)}),this.options.forEach(function(t,n){t.on("mouseover.results",function(){e.index=n,e.updateSelected()}).on("mouseout.results",function(){e.index=-1,e.updateSelected()})})}},{key:"updateSelected",value:function(){var t=this;this.options.forEach(function(e,n){e.classed("selected",n===t.index)})}},{key:"keydown",value:function(t){38==t?this.up():40==t&&this.down(),this.updateSelected()}},{key:"up",value:function(){this.index>=0&&(this.index-=1)}},{key:"down",value:function(){this.index<this.options.length-1&&(this.index+=1)}},{key:"enter",value:function(){console.log("asd");var t=this.options[this.index];t.on("click")(t.datum())}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),Autosuggest=function(){function t(e,n){_classCallCheck(this,t),this.sources=n.map(AutosuggestSource.fromJSON),this.results=new AutosuggestResults(e),this._currentTerm="",this._time=Date.now()}return _createClass(t,[{key:"listen",value:function(t){var e=this;d3.select(t).on("keydown",function(){var t=d3.event.keyCode;13==t?(d3.event.preventDefault(),e.enter()):e.results.keydown(t)}).on("input",function(){e.throttledSuggest(this.value)})}},{key:"throttledSuggest",value:function(t){var e=this;delay(Constants.AUTOCOMPLETE_WAIT_MS).then(function(){t===e._currentTerm&&e.suggest(t)}),this._currentTerm=t}},{key:"suggest",value:function(t){var e=this;""===t?this.results.hide():!function(){var n=Date.now(),o=e.sources.map(function(e){return e.get(t)});Promise.all(o).then(function(t){n>e._time&&(e._time=n,e.results.show(e.sources,t))})}()}},{key:"enter",value:function(){if(this.results.index<0){var t="/search?"+$.param({q:this._currentTerm});window.location.href=t}else this.results.enter()}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),DatasetPopup=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"show",value:function(t){var e=t.name||"Untitled",n=t.domain||"",o=t.description||"",a=t.tags||"";$("#dataset-lightbox h1").text(e),$("#dataset-lightbox .publisher").text(n),$("#dataset-lightbox .publisher").attr("href","http://"+n),$("#dataset-lightbox .tags span").text(a),0===o.length&&0===a.length?($("#dataset-lightbox .description-container").hide(0),$("#dataset-lightbox .description").hide(0),$("#dataset-lightbox .tags").hide(0)):($("#dataset-lightbox .description-container").show(0),o.length>0?$("#dataset-lightbox .description").html(o.replace("\n","<br>")).show(0):$("#dataset-lightbox .description").hide(0),a.length>0?($("#dataset-lightbox .tags span").text(a),$("#dataset-lightbox .tags").show(0)):$("#dataset-lightbox .tags").hide(0)),$.featherlight("#dataset-lightbox")}}]),t}(),domain="odn.data.socrata.com",_nameToColumn=new Map;_nameToColumn.set("population","population"),_nameToColumn.set("earnings","earnings"),_nameToColumn.set("education","education"),_nameToColumn.set("occupations","occupations"),_nameToColumn.set("cost_of_living","rpp"),_nameToColumn.set("gdp","gdp");var defaultColumn="population",_withDataSource={name:"Regions with Data",domain:domain,fxf:"68ht-6puw",encoded:["id","type","population"],show:function(t,e){t.append("span").attr("class","name").text(e.text).append("span").attr("id","tag").text(e.type)},sort:function(t){return-parseFloat(t.population)}};$(document).ready(function(){$(".slider").slick({arrows:!1,autoplay:!0,autoplaySpeed:2e3,slidesToScroll:1,slidesToShow:5}),multiComplete("#q",".region-list").listen(),$("#search-button").click(function(){$("#form").submit()}),$("#menu-item-communities").mouseenter(function(){$("#menu-communities").slideToggle(100),$("#menu-item-communities").addClass("selected"),searchMenu.hideOptionsMenu()}),$("#menu-item-communities").mouseleave(function(){$("#menu-communities").hide(100),$("#menu-item-communities").removeClass("selected")})});
//# sourceMappingURL=home.min.js.map
