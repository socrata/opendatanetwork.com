"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function delay(e){return new Promise(function(t,a){setTimeout(t,e)})}function multiComplete(e,t){function a(e){window.location.href=e}var n="odn.data.socrata.com",r=[{name:"Datasets",image:"fa-bar-chart",domain:n,fxf:"fpum-bjbr",column:"encoded",encoded:["domain","fxf"],select:function(e){return a("/dataset/"+e.domain+"/"+e.fxf)},show:function(e,t){e.append("span").attr("class","name").text(t.text).append("span").attr("id","tag").text(t.domain)}},{name:"Regions",image:"fa-globe",domain:n,fxf:"68ht-6puw",column:"all",encoded:["id","type","population"],select:function(e){a("/region/"+e.id+"/"+e.text.replace(/ /g,"_").replace(/,/g,""))},sort:function(e){return-parseFloat(e.population)}},{name:"Publishers",image:"fa-newspaper-o",domain:n,fxf:"8ae5-ghum",column:"domain",select:function(e){return a("/search?domains="+e.text)}},{name:"Categories",image:"fa-fighter-jet",domain:n,fxf:"864v-r7tf",column:"category",select:function(e){return a("/search?categories="+e.text)},show:function(e,t){e.append("span").attr("class","capitalize").text(t.text)}}],o=new Autosuggest(t,r);return o.listen(e),o}function regionsWithData(e,t){var a=_nameToColumn.has(e)?_nameToColumn.get(e):defaultColumn;return[_.extend({},_withDataSource,{select:t,column:a})]}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function variableGenerator(){var e=arguments.length<=0||void 0===arguments[0]?[2013]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?parseFloat:arguments[1];return function(a){return a.map(function(a){var n=_slicedToArray(a,3),r=n[0],o=n[1],i=n[2];return{name:r,column:o,format:i,years:e,value:t}})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}$(document).ready(function(){$(".search-link").click(function(){var e=$("#q").val().trim();0===e.length?$("#q").focus():$("#form").submit()})}),Array.prototype.includes=function(e){return this.indexOf(e)>-1},String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,a){return"undefined"!=typeof e[a]?e[a]:t})},String.prototype.split2=function(e){var t=this.split(e);return 1==t.length&&""===t[0]?[]:t};var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),ApiController=function(){function e(){_classCallCheck(this,e),this.categoriesUrl="/categories.json",this.childRegionsUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&$limit={1}",this.costOfLivingUrl="https://odn.data.socrata.com/resource/hpnf-gnfu.json?id={0}",this.datasetSummaryUrl="https://{0}/api/views/{1}.json",this.domainsUrl="https://api.us.socrata.com/api/catalog/v1/domains",this.earningsUrl="https://odn.data.socrata.com/resource/wmwh-4vak.json?id={0}",this.educationUrl="https://odn.data.socrata.com/resource/uf4m-5u8r.json?id={0}",this.gdpUrl="https://odn.data.socrata.com/resource/ks2j-vhr8.json?id={0}",this.mostPopulousRegionTypeUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_id={0}&child_type={1}&$limit={2}&$order=child_population desc",this.occupationsUrl="https://odn.data.socrata.com/resource/qfcm-fw3i.json?$order=occupation&id={0}",this.parentStateUrl="https://odn.data.socrata.com/resource/eyae-8jfy?parent_type=state&child_id={0}",this.populationUrl="https://odn.data.socrata.com/resource/e3rd-zzmr.json?id={0}",this.similarRegionsUrl="https://socrata-peers.herokuapp.com/peers.json?id={0}&vectors={1}&n=5",this.supportedVectorsUrls="https://socrata-peers.herokuapp.com/supported.json?id={0}",this.healthDataUrls={rwjf_county_health_rankings_2015:"https://odn.data.socrata.com/resource/7ayp-utp2.json?id={0}",cdc_brfss_prevalence_overall_health:"https://odn.data.socrata.com/resource/n4rt-3rmd.json?break_out_category=Overall&topic=Overall%20Health&response={0}&_geoid={1}"}}return _createClass(e,[{key:"getCategories",value:function(){return d3.promise.json(this.categoriesUrl)}},{key:"getChildRegions",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.childRegionsUrl.format(e,t))}},{key:"getCitiesInState",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(e,"place",t))}},{key:"getCostOfLivingData",value:function(e){return d3.promise.json(this.costOfLivingUrl.format(e))}},{key:"getCountiesInState",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(e,"county",t))}},{key:"getDatasetSummary",value:function(e,t){return d3.promise.json(this.datasetSummaryUrl.format(e,t))}},{key:"getDomains",value:function(){return d3.promise.json(this.domainsUrl)}},{key:"getEarningsData",value:function(e){return d3.promise.json(this.earningsUrl.format(e))}},{key:"getEducationData",value:function(e){return d3.promise.json(this.educationUrl.format(e))}},{key:"getGdpData",value:function(e){return d3.promise.json(this.gdpUrl.format(e))}},{key:"getMetrosInState",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?10:arguments[1];return d3.promise.json(this.mostPopulousRegionTypeUrl.format(e,"msa",t))}},{key:"getOccupationsData",value:function(e){return d3.promise.json(this.occupationsUrl.format(e))}},{key:"getParentState",value:function(e){return d3.promise.json(this.parentStateUrl.format(e.id))}},{key:"getPopulationData",value:function(e){return d3.promise.json(this.populationUrl.format(e))}},{key:"getSimilarRegions",value:function(e,t){return d3.promise.json(this.similarRegionsUrl.format(e,t.join(",")))}},{key:"getSupportedVectors",value:function(e){return d3.promise.json(this.supportedVectorsUrls.format(e))}},{key:"getHealthRwjfChrData",value:function(e){return d3.promise.json(this.healthDataUrls.rwjf_county_health_rankings_2015.format(e))}},{key:"getHealthCdcBrfssPrevalenceOverallHealthData",value:function(e,t){return d3.promise.json(this.healthDataUrls.cdc_brfss_prevalence_overall_health.format(t,e))}}]),e}(),Constants={ROSTER_URL:"https://federal.demo.socrata.com/resource/bdeb-mf9k.json",AUTOCOMPLETE_SEPARATOR:":",AUTOCOMPLETE_URL:function(e,t,a,n){return"https://"+e+"/views/"+t+"/columns/"+a+"/suggest/"+n},AUTOCOMPLETE_WAIT_MS:150,AUTOCOMPLETE_MAX_OPTIONS:100,AUTOCOMPLETE_SHOWN_OPTIONS:5},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),RegionLookup=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(e){return $.getJSON(Constants.ROSTER_URL+"?"+$.param(e))}},{key:"getOne",value:function(t){function a(e){if(0===e.length)return console.warn("no regions found for params: "),console.warn(t),null;if(1===e.length)return e[0];var a=_.filter(e,function(e){return"place"===e.type});return a.length>0?a[0]:e[0]}return new Promise(function(n,r){e.get(t).then(function(e){n(a(e))},function(e){throw e})})}},{key:"byName",value:function(t){return e.getOne({name:t})}},{key:"byID",value:function(t){return e.getOne({id:t})}}]),e}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),Sources=function(){function e(t){_classCallCheck(this,e),this.sources=t}return _createClass(e,[{key:"forRegions",value:function(t){var a=new Set(t.map(function(e){return e.type}));return this.sources.filter(function(t){var n=new Set(t.regions);return e.intersection(n,a).size>0})}}],[{key:"intersection",value:function(e,t){return new Set([].concat(_toConsumableArray(e)).filter(function(e){return t.has(e)}))}}]),e}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),Base64=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"encode",value:function(e){return btoa(unescape(encodeURIComponent(str)))}},{key:"decode",value:function(e){return decodeURIComponent(escape(atob(e)))}}]),e}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),AutosuggestSource=function(){function e(t,a,n,r,o,i,s,l,c){_classCallCheck(this,e),this.name=t,this.image=a,this.domain=n,this.fxf=r,this.column=o,this.encoded=i,this.select=s,this.show=l,this.sort=c}return _createClass(e,[{key:"get",value:function(e){var t=this;return new Promise(function(a,n){if(""===e)a([]);else{var r=Constants.AUTOCOMPLETE_URL(t.domain,t.fxf,t.column,e),o=t.sort?Constants.AUTOCOMPLETE_MAX_OPTIONS:Constants.AUTOCOMPLETE_SHOWN_OPTIONS,i={size:o},s=r+"?"+$.param(i);$.getJSON(s).then(function(e){a(e.options.map(function(e){return t.decode(e)}))},n)}})}},{key:"decode",value:function(e){if(this.encoded.length>0){var t=e.text,a=t.lastIndexOf(" "),n=t.substring(0,a),r=t.substring(a+1),o=Base64.decode(r),i=o.split(Constants.AUTOCOMPLETE_SEPARATOR);return _.extend({text:n},_.object(this.encoded,i))}return{text:e.text}}},{key:"display",value:function(e,t){var a=this;if(0===t.length)return[];this.sort&&(t=_.sortBy(t,this.sort).slice(0,Constants.AUTOCOMPLETE_SHOWN_OPTIONS));var n=e.append("li").attr("class","autocomplete-category");if(this.image){n.append("label").attr("class","autocomplete-title").text(this.name);if(t.length>1){n.append("div").append("i").attr("class","fa "+this.image)}}var r=n.append("ul").attr("class","autocomplete-options sub-list"),o=this;return r.selectAll("li").data(t).enter().append("li").attr("class","autocomplete-option").each(function(e){o.show(d3.select(this),e)}).on("click",function(e){return a.select(e)}).on("mouseover.source",function(){d3.select(this).classed("selected hovered",!0)}).on("mouseout.source",function(){d3.select(this).classed("selected hovered",!1)})[0]}}],[{key:"fromJSON",value:function(t){var a=t.encoded||[],n=t.show||function(e,t){e.append("span").text(t.text)};return new e(t.name,t.image,t.domain,t.fxf,t.column,a,t.select,n,t.sort)}}]),e}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),AutosuggestResults=function(){function e(t){_classCallCheck(this,e),this.results=d3.select(t),this.options=[],this.index=-1,this.autohide()}return _createClass(e,[{key:"autohide",value:function(){var e=this;d3.select("html").on("click.results",function(){return e.hide()}),this.results.on("click.results",function(){return d3.event.stopPropagation()})}},{key:"hide",value:function(){this.results.style("display","none")}},{key:"unhide",value:function(){this.results.style("display","block")}},{key:"empty",value:function(){this.results.html("")}},{key:"display",value:function(e){var t=this;return new Promise(function(a,n){t.source.get(e).then(function(e){t.empty(),0===e.length?(t.hide(),a([])):(t.unhide(),a(t.source.display(t.results,e)))},function(e){throw e})})}},{key:"show",value:function(e,t){var a=this;this.empty();var n=e.map(function(e,n){var r=t[n];return e.display(a.results,r)});this.updateOptions(_.flatten(n)),this.unhide()}},{key:"updateOptions",value:function(e){var t=this;this.options=e.map(function(e){return d3.select(e)}),this.options.forEach(function(e,a){e.on("mouseover.results",function(){t.index=a,t.updateSelected()}).on("mouseout.results",function(){t.index=-1,t.updateSelected()})})}},{key:"updateSelected",value:function(){var e=this;this.options.forEach(function(t,a){t.classed("selected",a===e.index)})}},{key:"keydown",value:function(e){38==e?this.up():40==e&&this.down(),this.updateSelected()}},{key:"up",value:function(){this.index>=0?this.index-=1:-1==this.index&&(this.index=this.options.length-1)}},{key:"down",value:function(){this.index<this.options.length-1&&(this.index+=1)}},{key:"enter",value:function(){var e=this.options[this.index];e.on("click")(e.datum())}}]),e}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),Autosuggest=function(){function e(t,a){_classCallCheck(this,e),this.sources=a.map(AutosuggestSource.fromJSON),this.results=new AutosuggestResults(t),this._currentTerm="",this._time=Date.now()}return _createClass(e,[{key:"listen",value:function(e){var t=this;d3.select(e).on("keydown",function(){var e=d3.event.keyCode;13==e?(d3.event.preventDefault(),t.enter()):t.results.keydown(e)}).on("input",function(){t.throttledSuggest(this.value)})}},{key:"throttledSuggest",value:function(e){var t=this;delay(Constants.AUTOCOMPLETE_WAIT_MS).then(function(){e===t._currentTerm&&t.suggest(e)}),this._currentTerm=e}},{key:"suggest",value:function(e){var t=this;""===e?this.results.hide():!function(){var a=Date.now(),n=t.sources.map(function(t){return t.get(e)});Promise.all(n).then(function(e){a>t._time&&(t._time=a,t.results.show(t.sources,e))})}()}},{key:"enter",value:function(){if(this.results.index<0){var e="/search?"+$.param({q:this._currentTerm});window.location.href=e}else this.results.enter()}}]),e}(),domain="odn.data.socrata.com",_nameToColumn=new Map;_nameToColumn.set("population","population"),_nameToColumn.set("earnings","earnings"),_nameToColumn.set("education","education"),_nameToColumn.set("occupations","occupations"),_nameToColumn.set("cost_of_living","rpp"),_nameToColumn.set("gdp","gdp"),_nameToColumn.set("health","health");var defaultColumn="all",_withDataSource={name:"Regions with Data",domain:domain,fxf:"68ht-6puw",encoded:["id","type","population"],sort:function(e){return-parseFloat(e.population)}},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),Scale=function(){function e(t,a,n){_classCallCheck(this,e),this.values=t,this.range=a,this.scale=n}return _createClass(e,null,[{key:"quantile",value:function(t,a){t.sort(d3.ascending);var n=1/a.length,r=_.map(a.slice(1),function(e,a){return d3.quantile(t,(a+1)*n)}),o=d3.scale.quantile().domain(r).range(a);return new e(t,a,o)}}]),e}(),MapConstants={LIMIT:5e3,CSS_ID:"leaflet-map",BASE_LAYER_URL:"https://a.tiles.mapbox.com/v3/socrata-apps.ibp0l899/{z}/{x}/{y}.png",BASE_LAYER:{opacity:.5},COLOR_SCALE:colorbrewer.RdYlBu[9],SCALE:Scale.quantile,MAP_OPTIONS:{minZoom:3,maxZoom:12,zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1},ZOOM_CONTROL:!0,ZOOM_CONTROL_OPTIONS:{position:"topleft"},INITIAL_CENTER:[37.1669,-95.9669],INITIAL_ZOOM:4,AUTO_ZOOM_OPTIONS:{animate:!1,maxZoom:10},AUTO_ZOOM_OUT:1,POINT_RADIUS_SCALE:d3.scale.log,POINT_RADIUS_RANGE_METERS:[500,2e3],BASE_STYLE:{color:"#34495e",weight:1,opacity:1,fill:!1,fillOpacity:1},SELECTED_STYLE:{stroke:!0,color:"#8e44ad",weight:3,opacity:1},TOOLTIP_OPTIONS:{offset:L.point(0,-20),closeButton:!1,closeOnClick:!1},TOPOJSON_DIRECTORY:"/geo/",TOPOJSON_SUFFIX:".topo.json",REGIONS:{nation:{name:"USA",id:"nation",topo:"nation",type:"choropleth"},region:{name:"Regions",id:"region",topo:"region",type:"choropleth"},division:{name:"Divisions",id:"division",topo:"division",type:"choropleth"},state:{name:"States",id:"state",topo:"state",type:"choropleth"},county:{name:"Counties",id:"county",topo:"county",type:"choropleth"},msa:{name:"Metros",id:"msa",topo:"cbsa",type:"choropleth"},place:{name:"Cities",id:"place",topo:"places",type:"point"}},DEFAULT_REGION:"state"},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),TopoModel=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(e){var t=MapConstants.TOPOJSON_DIRECTORY+e.topo+MapConstants.TOPOJSON_SUFFIX;return $.getJSON(t)}}]),e}(),MapModel=function(){function e(t,a,n,r,o){_classCallCheck(this,e),this.source=t,this.region=a,this.variable=n,this.year=r,this.regions=o,this.regionById=e.makeLookup(o,function(e){return e.id})}return _createClass(e,[{key:"values",value:function(){return this.regions.map(function(e){return e.value})}},{key:"scale",value:function(e,t){return this.variable.reverse&&t.reverse(),e(this.values(),t)}}],[{key:"makeLookup",value:function(e,t){var a=new Map;return _.each(e,function(e){return a.set(t(e),e)}),a}},{key:"create",value:function(t,a,n,r){var o=t.idColumn||"id",i=t.typeColumn||"type",s=t.nameColumn||"name",l=t.yearColumn||"year",c=t.hasPopulation||!1,u=t.populationColumn||"population";return new Promise(function(h,d){function p(o){var i=o.map(function(e){var t=n.value(e[n.column]);return{id:e.id,type:e.type,name:e.name,value:t,valueName:n.name,valueFormatted:n.format(t),year:r}});h(new e(t,a,n,r,i))}function g(e){throw e}var f=[o,i,s,l],m=f.concat([n.column]),v=_defineProperty({type:a.id,$select:m.join(),$limit:MapConstants.LIMIT},l,r),y=c?{$order:u+" DESC"}:{},C=_.extend({},v,y,n.params),w="https://"+t.domain+"/resource/"+t.fxf+".json?"+$.param(C);$.getJSON(w).then(p,g)})}}]),e}(),_slicedToArray=function(){function e(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(l){r=!0,o=l}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw o}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),LegendControl=L.Control.extend({options:{position:"bottomleft"},onAdd:function(e){var t=L.DomUtil.create("div","legend-container");return this.container=d3.select(t),t},update:function(e,t,a){this.container.selectAll("*").remove();var n=10,r=e.range.slice();r.reverse();var o=r.length*n,i=200,s=i/2,l=this.container.append("div").attr("class","legend-container").style("width",i),c=_.filter(e.values,function(e){return!isNaN(e)}),u=d3.extent(c),h=_slicedToArray(u,2),d=h[0],p=h[1],g=d3.quantile(c,.25),f=d3.median(c),m=d3.quantile(c,.75),v=[p,m,f,g,d],y=["maximum","upper quartile","median","lower quartile","minimum"],C=_.zip(v,y),w=o/(C.length-1),k=l.append("svg").attr("width",i).attr("height",o+15).attr("class","legend"),b=k.append("g").attr("class","ticks"),O=b.selectAll("g.tick").data(C).enter().append("g").attr("class","tick").attr("transform",function(e,t){return"translate("+s+", "+(n+t*w)+")"});O.append("line").attr("class","tick-line").attr("x1",n).attr("y1",0).attr("x2",2*n).attr("y2",0),O.append("line").attr("class","tick-line").attr("x1",-n).attr("y1",0).attr("x2",0).attr("y2",0);var S="middle",T=2;O.append("text").attr("class","tick-value").text(function(e){return t.format(e[0])}).attr("alignment-baseline",S).attr("transform","translate("+(2*n+T)+", 0)"),O.append("text").attr("class","tick-label").text(function(e){return e[1]}).attr("text-anchor","end").attr("alignment-baseline",S).attr("transform","translate("+-(n+T)+", 0)");k.selectAll("rect").data(r).enter().append("rect").attr("class","legend-element").attr("x",s).attr("y",function(e,t){return(t+1)*n}).attr("width",n).attr("height",n).style("stroke","none").style("fill",function(e){return e});k.append("rect").attr("class","legend-box").attr("x",s).attr("y",n).attr("width",n).attr("height",o)}}),TooltipControl=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){var t=this,a=L.DomUtil.create("div","tooltip");this.container=d3.select(a).style("display","none"),this.name=this.container.append("div").attr("class","name"),this.value=this.container.append("div").attr("class","value"),this.shown=!1;var n=$("#map"),r=n.offset(),o=r.left,i=r.top,s=n.width(),l=n.height();return window.onresize=function(){var e=n.offset();o=e.left,i=e.top},document.addEventListener("mousemove",function(e){if(t.shown){var a=e.pageX-o-s,n=e.pageY-i-l;t.container.style("left",a-20+"px").style("top",n-10+"px")}}),a},show:function(e,t){this.name.text(e),this.value.text(t),this.unhide()},showRegion:function(e){this.show(e.name,e.valueName+" ("+e.year+"): "+e.valueFormatted)},hide:function(){this.shown=!1,this.container.style("display","none")},unhide:function(){this.shown=!0,this.container.style("display","inline")}}),VariableControl=L.Control.extend({initialize:function(e,t){this.variables=e,this.callback=t},options:{position:"topleft"},onAdd:function(e){function t(e){var t=e.property("value"),a=e.select("option[value='"+t+"']");return a.datum()}function a(){c.selectAll("option").remove(),_.contains(o.years,i)||(i=o.years[o.years.length-1]),c.selectAll("option").data(o.years).enter().append("option").property("selected",function(e){return e===i}).attr("value",function(e){return e}).text(function(e){return e})}var n=this,r=L.DomUtil.create("div","variable-container");this.container=d3.select(r);var o=this.variables[0],i=o.years[o.years.length-1],s=function(){n.callback(o,i)};s();var l=this.container.append("select").attr("class","variable-select").on("change",function(){o=t(l),a(),s()}),c=(l.selectAll("option").data(this.variables).enter().append("option").property("selected",function(e){return e===o}).attr("value",function(e){return e.name}).text(function(e){return e.name}),this.container.append("select").attr("class","year-select").on("change",function(){i=t(c),s()}));return a(),r}}),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),MapView=function(){function e(t,a,n,r){var o=this;_classCallCheck(this,e),this.source=t,this.regionType=a,this.regions=n,this.regionIDs=new Set(n.map(function(e){return e.id})),this.features=r,this.legend=new LegendControl,this.tooltip=new TooltipControl,this.variableControl=new VariableControl(t.variables,function(e,t){o.display(e,t)}),this.zoomControl=new L.Control.Zoom(MapConstants.ZOOM_CONTROL_OPTIONS)}return _createClass(e,[{key:"show",value:function(e){var t=this,a=(d3.select(e).append("div").attr("class","map-container").attr("id",MapConstants.CSS_ID),L.map(MapConstants.CSS_ID,MapConstants.MAP_OPTIONS));a.setView(MapConstants.INITIAL_CENTER,MapConstants.INITIAL_ZOOM);var n=L.tileLayer(MapConstants.BASE_LAYER_URL,MapConstants.BASE_LAYER);a.addLayer(n),a.addControl(this.legend),a.addControl(this.variableControl),a.addControl(this.tooltip),MapConstants.ZOOM_CONTROL&&a.addControl(this.zoomControl),a.whenReady(function(){a.addLayer(t.features),t.zoomToSelected(a)})}},{key:"zoomToSelected",value:function(e){var t=this,a=[];this.features.eachLayer(function(e){t.regionIDs.has(e.feature.id)&&a.push(e)});var n=new L.featureGroup(a);e.fitBounds(n.getBounds(),MapConstants.AUTO_ZOOM_OPTIONS),"choropleth"===this.regionType.type&&1===a.length&&e.zoomOut(MapConstants.AUTO_ZOOM_OUT,MapConstants.AUTO_ZOOM_OPTIONS)}},{key:"display",value:function(e,t){var a=this;MapModel.create(this.source,this.regionType,e,t).then(function(e){return a.update(e)})["catch"](function(e){throw e})}},{key:"update",value:function(e){var t=e.scale(MapConstants.SCALE,MapConstants.COLOR_SCALE);this.updateLegend(e,t),this.updateFeatures(e,t)}},{key:"updateLegend",value:function(e,t){this.legend.update(t,e.variable,e.year)}},{key:"updateFeatures",value:function(e,t){var a=this;this.features.eachLayer(function(n){var r=n.feature.id;e.regionById.has(r)&&!function(){var o=e.regionById.get(r),i=a.regionIDs.has(o.id),s={fill:!0,fillColor:t.scale(o.value)},l=i?_.extend(s,MapConstants.SELECTED_STYLE):s;n.setStyle(l),n.on({mouseover:function(){return a.tooltip.showRegion(o)},mouseout:function(){return a.tooltip.hide()}})}()})}}],[{key:"create",value:function(t,a){if(a.length<1)throw"regions cannot be empty";var n=MapConstants.REGIONS[a[0].type],r=_.filter(a,function(e){return e.type==n.id});return new Promise(function(a,o){function i(o){var i=e._features(o,"choropleth"==n.type);a(new e(t,n,r,i))}TopoModel.get(n).then(i,o)})}},{key:"_features",value:function(e,t){var a=function(){var e={stroke:!1},a=t?MapConstants.BASE_STYLE:_.extend({},MapConstants.BASE_STYLE,e);return{style:function(){return a}}},n=function(){var t=e.objects,a=e.objects[Object.keys(t)[0]].geometries,n=function(e){return e.properties.population},r=a.map(n),o=MapConstants.POINT_RADIUS_SCALE().domain(d3.extent(r)).range(MapConstants.POINT_RADIUS_RANGE_METERS);return{pointToLayer:function(e,t){return L.circle(t,o(n(e)))}}},r=t?a():_.extend({},a(),n()),o=L.geoJson(null,r);return omnivore.topojson.parse(e,null,o)}}]),e}(),format={integer:d3.format(",.0f"),percent:function(e){return d3.format(".2f")(e)+"%"},dollar:d3.format("$,.0f")},_slicedToArray=function(){function e(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(l){r=!0,o=l}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw o}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),DOMAIN="odn.data.socrata.com",MapSources={population:{name:"population",domain:DOMAIN,fxf:"e3rd-zzmr",hasPopulation:!0,variables:[{name:"Population",column:"population",years:[2009,2010,2011,2012,2013],value:parseFloat,format:format.integer},{name:"Population Change",column:"population_percent_change",years:[2010,2011,2012,2013],value:parseFloat,format:format.percent}]},earnings:{name:"earnings",domain:DOMAIN,fxf:"wmwh-4vak",hasPopulation:!0,variables:variableGenerator()([["Median Earnings","median_earnings",format.dollar],["Median Female Earnings","female_median_earnings",format.dollar],["Median Male Earnings","male_median_earnings",format.dollar],["Median Female Earnings (Full Time)","female_full_time_median_earnings",format.dollar],["Median Male Earnings (Full Time)","male_full_time_median_earnings",format.dollar],["Percent Earning less than $10,000","percent_with_earnings_1_to_9999",format.percent],["Percent Earning $10,000 to $14,999","percent_with_earnings_10000_to_14999",format.percent],["Percent Earning $15,000 to $24,999","percent_with_earnings_15000_to_24999",format.percent],["Percent Earning $25,000 to $34,999","percent_with_earnings_25000_to_34999",format.percent],["Percent Earning $35,000 to $49,999","percent_with_earnings_35000_to_49999",format.percent],["Percent Earning $50,000 to $64,999","percent_with_earnings_50000_to_64999",format.percent],["Percent Earning $65,000 to $74,999","percent_with_earnings_65000_to_74999",format.percent],["Percent Earning $75,000 to $99,999","percent_with_earnings_75000_to_99999",format.percent],["Percent Earning over $100,000","percent_with_earnings_over_100000",format.percent]])},education:{name:"education",domain:DOMAIN,fxf:"uf4m-5u8r",hasPopulation:!0,variables:variableGenerator()([["High School Graduation Rate","percent_high_school_graduate_or_higher",format.percent],["College Graduation Rate","percent_bachelors_degree_or_higher",format.percent]])},occupations:{name:"occupations",domain:DOMAIN,fxf:"qfcm-fw3i",hasPopulation:!0,variables:["Management","Business and Finance","Computers and Math","Engineering","Social Sciences","Social Services","Legal","Education","Media","Healthcare","Health Technicians","Health Support","Fire Fighting","Law Enforcement","Food Service","Janitorial","Personal Care","Sales","Office and Administration","Farming, Fishing, Foresty","Construction and Extraction","Repair","Production","Transportation","Material Moving"].map(function(e){return{name:e,column:"percent_employed",params:{occupation:e},years:[2013],value:parseFloat,format:format.percent}})},gdp:{name:"gdp",domain:DOMAIN,fxf:"ks2j-vhr8",variables:[{name:"GDP per Capita",column:"per_capita_gdp",years:_.range(2001,2014),value:parseFloat,format:format.dollar},{name:"Annual Change in GDP",column:"per_capita_gdp_percent_change",years:_.range(2002,2014),value:parseFloat,format:format.percent}]},rpp:{name:"rpp",domain:DOMAIN,fxf:"hpnf-gnfu",variables:["All","Goods","Rents","Other"].map(function(e){return{name:e,column:"index",reverse:!0,params:{component:e},years:_.range(2008,2014),value:parseFloat,format:d3.format(".1f")}})}},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),SearchPageController=function(){function e(t){function a(e){RegionLookup.byID(e.id).then(function(e){n.setAutoSuggestedRegion({id:e.id,name:e.name},!1),n.navigate()},function(e){throw e})}_classCallCheck(this,e),this.MAP_COLOR_SCALE=colorbrewer.RdYlBu[9],this.MAP_INITIAL_ZOOM=10,this.MAP_RADIUS_SCALE=[500,2e3],this.params=t,this.fetching=!1,this.fetchedAll=!1,this.mostSimilar=[];var n=this;$(".refine-link").mouseenter(function(){$(this).addClass("refine-link-selected"),$(this).children("span").children("i").removeClass("fa-caret-down").addClass("fa-caret-up"),$(this).children("ul").slideDown(100)}),$(".refine-link").mouseleave(function(){$(this).removeClass("refine-link-selected"),$(this).children("span").children("i").removeClass("fa-caret-up").addClass("fa-caret-down"),$(this).children("ul").slideUp(100)}),this.attachCategoriesClickHandlers(),$("#refine-menu-categories-view-more").click(function(){var e=new ApiController;e.getCategories().then(function(e){var t=e.results.map(function(e){return'<li><i class="fa '+e.metadata.icon+'"></i>'+e.category+"</li>"}),a=t.join("");$("#refine-menu-categories").html(a),n.attachCategoriesClickHandlers()})["catch"](function(e){return console.error(e)})}),this.attachDomainsClickHandlers(),$("#refine-menu-domains-view-more").click(function(){var e=new ApiController;e.getDomains().then(function(e){var t=e.results.map(function(e){
return"<li>"+e.domain+"</li>"}),a=t.join("");$("#refine-menu-domains").html(a),n.attachDomainsClickHandlers()})["catch"](function(e){return console.error(e)})}),this.attachTagsClickHandlers(),$(".region-token .fa-times-circle").click(function(){n.removeRegion($(this).parent().index()),n.navigate()}),$(".category-token .fa-times-circle").click(function(){n.toggleCategory($(this).parent().text().toLowerCase().trim()),n.navigate()}),$(".domain-token .fa-times-circle").click(function(){n.toggleDomain($(this).parent().text().toLowerCase().trim()),n.navigate()}),$(".standard-token .fa-times-circle").click(function(){n.toggleTag($(this).parent().text().toLowerCase().trim()),n.navigate()}),$(window).on("scroll",function(){var e=1e3;$(window).scrollTop()>=$(document).height()-$(window).height()-e&&n.fetchNextPage()}).scroll();var r=regionsWithData(this.params.vector,a),o=new Autosuggest(".add-region-results",r);o.listen(".add-region-input"),$(".add-region .fa-plus").click(function(){$('.add-region input[type="text"]').focus()}),this.drawSimilarRegions(function(e){n.setAutoSuggestedRegion(e,!1),n.navigate()}),this.drawPlacesInRegion()}return _createClass(e,[{key:"drawMap",value:function(e){var t="#map",a=this.params.regions;MapView.create(e,a).then(function(e){return e.show(t)},function(e){throw e})}},{key:"attachCategoriesClickHandlers",value:function(){var e=this;$("#refine-menu-categories li:not(.refine-view-more)").click(function(){e.toggleCategory($(this).text().toLowerCase().trim()),e.navigate()})}},{key:"attachDomainsClickHandlers",value:function(){var e=this;$("#refine-menu-domains li:not(.refine-view-more)").click(function(){var t=$(this).text().toLowerCase().trim();e.toggleDomain(t),e.navigate()})}},{key:"attachTagsClickHandlers",value:function(){var e=this;$("#refine-menu-tags li").click(function(){var t=$(this).text().toLowerCase().trim();e.toggleTag(t),e.navigate()})}},{key:"decrementPage",value:function(){this.params.page--}},{key:"drawCostOfLivingData",value:function(){var e=this;google.setOnLoadCallback(function(){var t=new ApiController,a=e.params.regions.map(function(e){return t.getCostOfLivingData(e.id)});Promise.all(a).then(function(t){e.drawMap(MapSources.rpp),e.drawCostOfLivingChart(t),e.drawCostOfLivingTable(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawCostOfLivingChart",value:function(e){this.drawCostOfLivingChartForComponent("cost-of-living-all-chart","All",e),this.drawCostOfLivingChartForComponent("cost-of-living-goods-chart","Goods",e),this.drawCostOfLivingChartForComponent("cost-of-living-rents-chart","Rents",e),this.drawCostOfLivingChartForComponent("cost-of-living-other-chart","Other",e)}},{key:"drawCostOfLivingChartForComponent",value:function(e,t,a){for(var n=[],r=["Year"],o=0;o<this.params.regions.length;o++)r.push(this.params.regions[o].name);n.push(r);for(var i={},o=0;o<a.length;o++)for(var s=a[o],l=0;l<s.length;l++)s[l].component==t&&(void 0==i[s[l].year]&&(i[s[l].year]=[s[l].year]),i[s[l].year].push(parseFloat(s[l].index)));for(var c in i)n.push(i[c]);this.drawLineChart(e,n,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:t})}},{key:"drawCostOfLivingTable",value:function(e){var t="<tr>";t+="<td class='empty'></td>",t+="<td class='category-header'>All<br>(Value)</td>",t+="<td class='category-header'>All<br>(Percentile)</td>",t+="<td class='category-header'>Goods<br>(Value)</td>",t+="<td class='category-header'>Goods<br>(Percentile)</td>",t+="<td class='category-header'>Other<br>(Value)</td>",t+="<td class='category-header'>Other<br>(Percentile)</td>",t+="<td class='category-header'>Rents<br>(Value)</td>",t+="<td class='category-header'>Rents<br>(Percentile)</td>",t+="</tr>";for(var a=["All","Goods","Other","Rents"],n=0;n<this.params.regions.length;n++){t+="<tr class='color-"+n+"'>",t+="<td>"+this.params.regions[n].name+"<div></div></td>";for(var r=0;r<a.length;r++){var o=this.getLatestCostOfLiving(e[n],this.params.regions[n].id,a[r]),i=null!=o?parseFloat(o.index):"NA",s=null!=o?this.getPercentile(o.rank,o.total_ranks):"NA";t+="<td>"+i+"<div></div></td>",t+="<td>"+s+"<div></div></td>"}t+="</tr>"}$("#cost-of-living-table").html(t)}},{key:"getPercentile",value:function(e,t){var t=parseInt(t),e=parseInt(e),a=parseInt((t-e)/t*100);return numeral(a).format("0o")}},{key:"getLatestCostOfLiving",value:function(e,t,a){for(var n=null,r=0;r<e.length;r++)e[r].id==t&&e[r].component==a&&(null!=n?parseInt(e[r].year)<=parseInt(n.year)||(n=e[r]):n=e[r]);return n}},{key:"drawEarningsData",value:function(){var e=this;google.setOnLoadCallback(function(){var t=new ApiController,a=e.params.regions.map(function(e){return t.getEarningsData(e.id)});Promise.all(a).then(function(t){e.drawMap(MapSources.earnings),e.drawEarningsChart(t),e.drawEarningsTable(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawEarningsChart",value:function(e){for(var t=[],a=["Education Level"],n=0;n<this.params.regions.length;n++)a.push(this.params.regions[n].name);t.push(a);for(var r=["Some High School"],n=0;n<this.params.regions.length;n++)r.push(parseInt(e[n][0].median_earnings_less_than_high_school));t.push(r);for(var o=["High School"],n=0;n<this.params.regions.length;n++)o.push(parseInt(e[n][0].median_earnings_high_school));t.push(o);for(var i=["Some College"],n=0;n<this.params.regions.length;n++)i.push(parseInt(e[n][0].median_earnings_some_college_or_associates));t.push(i);for(var s=["Bachelor's"],n=0;n<this.params.regions.length;n++)s.push(parseInt(e[n][0].median_earnings_bachelor_degree));t.push(s);for(var l=["Graduate Degree"],n=0;n<this.params.regions.length;n++)l.push(parseInt(e[n][0].median_earnings_graduate_or_professional_degree));t.push(l),this.drawSteppedAreaChart("earnings-chart",t,{areaOpacity:0,connectSteps:!0,curveType:"function",focusTarget:"category",legend:{position:"bottom"},title:"Earnings by Education Level",vAxis:{format:"currency"}})}},{key:"drawEarningsTable",value:function(e){var t="<tr>";t+="<td class='empty'></td>",t+="<td class='category-header'>Median Earnings<br>(All Workers)</td>",t+="<td class='category-header'>Median Female Earnings<br>(Full Time)</td>",t+="<td class='category-header'>Median Male Earnings<br>(Full Time)</td>",t+="</tr>";for(var a=0;a<this.params.regions.length;a++)t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>",t+="<td>"+numeral(e[a][0].median_earnings).format("$0,0")+"<div></div></td>",t+="<td>"+numeral(e[a][0].female_full_time_median_earnings).format("$0,0")+"<div></div></td>",t+="<td>"+numeral(e[a][0].male_full_time_median_earnings).format("$0,0")+"<div></div></td>",t+="</tr>";$("#earnings-table").html(t)}},{key:"drawHealthData",value:function(){var e=this;google.setOnLoadCallback(function(){e.drawBrfssCharts();var t=new ApiController,a=e.params.regions.map(function(e){return t.getHealthRwjfChrData(e.id)});Promise.all(a).then(function(t){e.drawHealthDataOutcomesTable(t),e.drawHealthBehaviorsTable(t),e.drawHealthClinicalCareTable(t),e.drawHealthSocialEconomicFactorsTable(t),e.drawHealthPhysicalEnvironmentTable(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawBrfssCharts",value:function(){var e=this,t=this.params.regions.filter(function(e,t){return"state"==e.type});t.length>0?!function(){var a=jQuery("#cdc-brfss-overall-health-chart-selector").val(),n=t.map(function(e){return(new ApiController).getHealthCdcBrfssPrevalenceOverallHealthData(e.id,a)});Promise.all(n).then(function(t){e.drawBrfssOverallHealthChart(t,a)})["catch"](function(e){return console.error(e)})}():jQuery("#cdc-brfss").hide()}},{key:"drawBrfssOverallHealthChart",value:function(e,t){for(var a=this.params.regions.filter(function(e,t){return"state"==e.type}),n=[],r=["Year"],o=0;o<a.length;o++)r[o+1]=a[o].name;n.push(r);for(var i={},o=0;o<e.length;o++)for(var s=e[o],l=0;l<s.length;l++)void 0==i[s[l].year]&&(i[s[l].year]=[s[l].year]),i[s[l].year].push(parseInt(s[l].data_value));for(var c in i)n.push(i[c]);this.drawLineChart("cdc-brfss-overall-health-chart",n,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,vAxis:{title:"Crude Percentage of Respondents"},hAxis:{title:"Year"}})}},{key:"drawHealthDataOutcomesTable",value:function(e){var t="<tr>";t+="<th class='empty'></th>",t+="<th>Life Length</th>",t+="<th class='empty'></th>",t+="<th colspan='4'>Quality of Life</th>",t+="</tr>",t+="<tr>",t+="<td class='empty'></td>",t+="<td class='category-header'>Premature Death</td>",t+="<td class='empty'></td>",t+="<td class='category-header'>Poor or Fair Health</td>",t+="<td class='category-header'>Poor Physical Health Days</td>",t+="<td class='category-header'>Poor Mental Health Days</td>",t+="<td class='category-header'>Low Birth Weight</td>",t+="</tr>";for(var a=0;a<this.params.regions.length;a++){var n=e[a][0];t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>",t+=this.drawHealthDataTableCell(n,"premature_death_value","0,0"),t+="<td class='empty'></td>",t+=this.drawHealthDataTableCell(n,"poor_or_fair_health_value","0.0%"),t+=this.drawHealthDataTableCell(n,"poor_physical_health_days_value","0.0"),t+=this.drawHealthDataTableCell(n,"poor_mental_health_days_value","0.0"),t+=this.drawHealthDataTableCell(n,"low_birthweight_value","0.0"),t+="</tr>"}$("#rwjf-county-health-outcomes-table").html(t)}},{key:"drawHealthBehaviorsTable",value:function(e){var t="<tr>";t+="<th class='empty'></th>",t+="<th colspan='9'>Health Behaviors</th>",t+="</tr>",t+="<tr>",t+="<td class='empty'></td>",t+="<td class='category-header'>Adult Smoking</td>",t+="<td class='category-header'>Adult Obesity</td>",t+="<td class='category-header'>Food Environment Index</td>",t+="<td class='category-header'>Physical Inactivity</td>",t+="<td class='category-header'>Access to Exercise</td>",t+="<td class='category-header'>Excessive Drinking</td>",t+="<td class='category-header'>Alcohol Impaired Driving Deaths</td>",t+="<td class='category-header'>Sexually Transmitted Infections</td>",t+="<td class='category-header'>Teen Births</td>",t+="</tr>";for(var a=0;a<this.params.regions.length;a++){var n=e[a][0];t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>",t+=this.drawHealthDataTableCell(n,"adult_smoking_value","0.0%"),t+=this.drawHealthDataTableCell(n,"adult_obesity_value","0.0%"),t+=this.drawHealthDataTableCell(n,"food_environment_index_value","0.0"),t+=this.drawHealthDataTableCell(n,"physical_inactivity_value","0.0%"),t+=this.drawHealthDataTableCell(n,"access_to_exercise_opportunities_value","0.0%"),t+=this.drawHealthDataTableCell(n,"excessive_drinking_value","0.0%"),t+=this.drawHealthDataTableCell(n,"alcohol_impaired_driving_deaths_value","0.0%"),t+=this.drawHealthDataTableCell(n,"sexually_transmitted_infections_value","0,0"),t+=this.drawHealthDataTableCell(n,"teen_births_value","0,0"),t+="</tr>"}$("#rwjf-county-health-factors-table").html(t)}},{key:"drawHealthClinicalCareTable",value:function(e){var t="<tr>";t+="<th class='empty'></th>",t+="<th colspan='7'>Clinical Care</th>",t+="</tr>",t+="<tr>",t+="<td class='empty'></td>",t+="<td class='category-header'>Uninsured</td>",t+="<td class='category-header'>Primary Care Physicians</td>",t+="<td class='category-header'>Dentists</td>",t+="<td class='category-header'>Mental Health Providers</td>",t+="<td class='category-header'>Preventable Hospital Stays</td>",t+="<td class='category-header'>Diabetic Monitoring</td>",t+="<td class='category-header'>Mammography Screening</td>",t+="</tr>";for(var a=0;a<this.params.regions.length;a++){var n=e[a][0];t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>",t+=this.drawHealthDataTableCell(n,"uninsured_value","0.0%"),t+=this.drawHealthDataTableCell(n,"primary_care_physicians_value","0,0"),t+=this.drawHealthDataTableCell(n,"dentists_value","0,0"),t+=this.drawHealthDataTableCell(n,"mental_health_providers_value","0,0"),t+=this.drawHealthDataTableCell(n,"preventable_hospital_stays_value","0,0"),t+=this.drawHealthDataTableCell(n,"diabetic_screening_value","0.0%"),t+=this.drawHealthDataTableCell(n,"mammography_screening_value","0.0%"),t+="</tr>"}$("#rwjf-county-health-clinical-care-table").html(t)}},{key:"drawHealthSocialEconomicFactorsTable",value:function(e){var t="<tr>";t+="<th class='empty'></th>",t+="<th colspan='9'>Social &amp; Economic Factors</th>",t+="</tr>",t+="<tr>",t+="<td class='empty'></td>",t+="<td class='category-header'>High School Graduation</td>",t+="<td class='category-header'>Some College</td>",t+="<td class='category-header'>Unemployment</td>",t+="<td class='category-header'>Children in Poverty</td>",t+="<td class='category-header'>Income Inequality</td>",t+="<td class='category-header'>Children in Single-Parent Households</td>",t+="<td class='category-header'>Social Associations</td>",t+="<td class='category-header'>Violent Crime</td>",t+="<td class='category-header'>Injury Deaths</td>",t+="</tr>";for(var a=0;a<this.params.regions.length;a++){var n=e[a][0];t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>",t+=this.drawHealthDataTableCell(n,"high_school_graduation_value","0.0%"),t+=this.drawHealthDataTableCell(n,"some_college_value","0.0%"),t+=this.drawHealthDataTableCell(n,"unemployment_value","0.0%"),t+=this.drawHealthDataTableCell(n,"children_in_poverty_value","0.0%"),t+=this.drawHealthDataTableCell(n,"income_inequality_value","0.0"),t+=this.drawHealthDataTableCell(n,"children_in_single_parent_households_value","0.0%"),t+=this.drawHealthDataTableCell(n,"social_associations_value","0.0"),t+=this.drawHealthDataTableCell(n,"violent_crime_value","0.0"),t+=this.drawHealthDataTableCell(n,"injury_deaths_value","0.0"),t+="</tr>"}$("#rwjf-county-health-social-economic-factors-table").html(t)}},{key:"drawHealthPhysicalEnvironmentTable",value:function(e){var t="<tr>";t+="<th class='empty'></th>",t+="<th colspan='5'>Physical Environment</th>",t+="</tr>",t+="<tr>",t+="<td class='empty'></td>",t+="<td class='category-header'>Air Pollution - Particulate Matter</td>",t+="<td class='category-header'>Drinking Water Violations</td>",t+="<td class='category-header'>Severe Housing Problems</td>",t+="<td class='category-header'>Driving Alone to Work</td>",t+="<td class='category-header'>Long Commute - Driving Alone</td>",t+="</tr>";for(var a=0;a<this.params.regions.length;a++){var n=e[a][0];t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>",t+=this.drawHealthDataTableCell(n,"air_pollution_particulate_matter_value","0.0"),t+=this.drawHealthDataTableCell(n,"drinking_water_violations_value","0.0%"),t+=this.drawHealthDataTableCell(n,"severe_housing_problems_value","0.0%"),t+=this.drawHealthDataTableCell(n,"driving_alone_to_work_value","0.0%"),t+=this.drawHealthDataTableCell(n,"long_commute_driving_alone_value","0.0%"),t+="</tr>"}$("#rwjf-county-health-physical-environment-table").html(t)}},{key:"drawHealthDataTableCell",value:function(e,t,a){var n="<td>";return n+=void 0!=e[t]?numeral(e[t].replace(",","")).format(a):"",n+="<div></div></td>"}},{key:"drawEducationData",value:function(){var e=this;google.setOnLoadCallback(function(){var t=new ApiController,a=e.params.regions.map(function(e){return t.getEducationData(e.id)});Promise.all(a).then(function(t){e.drawMap(MapSources.education),e.drawEducationTable(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawEducationTable",value:function(e){var t="<tr>";t+="<td class='empty'></td>",t+="<td class='category-header'>At Least Bachelor's Degree<br>(Percent)</td>",t+="<td class='category-header'>At Least Bachelor's Degree<br>(Percentile)</td>",t+="<td class='category-header'>At Least High School Diploma<br>(Percent)</td>",t+="<td class='category-header'>At Least High School Diploma<br>(Percentile)</td>",t+="</tr>";for(var a=0;a<e.length;a++){var n=e[a][0];t+="<tr class='color-"+a+"'>",t+="<td>"+this.params.regions[a].name+"<div></div></td>";var r=parseInt(n.total_ranks),o=parseInt(n.percent_bachelors_degree_or_higher_rank),i=parseInt((r-o)/r*100);t+="<td>"+n.percent_bachelors_degree_or_higher+"%<div></div></td>",t+="<td>"+numeral(i).format("0o")+"<div></div></td>";var s=parseInt(n.percent_high_school_graduate_or_higher_rank),l=parseInt((r-s)/r*100);t+="<td>"+n.percent_high_school_graduate_or_higher+"%<div></div></td>",t+="<td>"+numeral(l).format("0o")+"<div></div></td>",t+="</tr>"}$("#education-table").html(t)}},{key:"drawGdpData",value:function(){var e=this;google.setOnLoadCallback(function(){var t=new ApiController,a=e.params.regions.map(function(e){return t.getGdpData(e.id)});Promise.all(a).then(function(t){e.drawMap(MapSources.gdp),e.drawGdpChart(t),e.drawGdpChangeChart(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawGdpChart",value:function(e){for(var t=[],a=["Year"],n=0;n<this.params.regions.length;n++)a[n+1]=this.params.regions[n].name;t.push(a);for(var r={},n=0;n<e.length;n++)for(var o=e[n],i=0;i<o.length;i++)void 0==r[o[i].year]&&(r[o[i].year]=[o[i].year]),r[o[i].year].push(parseFloat(o[i].per_capita_gdp));for(var s in r)t.push(r[s]);this.drawLineChart("per-capita-gdp-chart",t,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Per Capita Real GDP over Time"})}},{key:"drawGdpChangeChart",value:function(e){for(var t=[],a=["Year"],n=0;n<this.params.regions.length;n++)a[n+1]=this.params.regions[n].name;t.push(a);for(var r={},n=0;n<e.length;n++)for(var o=e[n],i=0;i<o.length;i++)void 0==r[o[i].year]&&(r[o[i].year]=[o[i].year]),r[o[i].year].push(parseFloat(o[i].per_capita_gdp_percent_change)/100);for(var s in r)t.push(r[s]);this.drawLineChart("per-capita-gdp-change-chart",t,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Annual Change in Per Capita GDP over Time",vAxis:{format:"#.#%"}})}},{key:"drawOccupationsData",value:function(){var e=this;google.setOnLoadCallback(function(){var t=new ApiController,a=e.params.regions.map(function(e){return t.getOccupationsData(e.id)});Promise.all(a).then(function(t){e.drawMap(MapSources.occupations),e.drawOccupationsTable(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawOccupationsTable",value:function(e){var t="<tr>";t+="<th class='empty'></th>";for(var a=0;a<this.params.regions.length;a++)t+="<th colspan='2' class='color-"+a+"'>"+this.params.regions[a].name+"<div></div></th>";t+="</tr>",t+="<tr><td class='empty'></td>";for(var a=0;a<this.params.regions.length;a++)t+="<td>Percent</td><td class='color-"+a+"'>Percentile<div></div></td>";for(var a=0;a<e[0].length;a++){t+="<tr><td class='category-header'>"+e[0][a].occupation+"</td>";for(var n=0;n<this.params.regions.length;n++){var r=e[n],o=parseInt(r[a].total_ranks),i=parseInt(r[a].percent_employed_rank),s=parseInt((o-i)/o*100);t+="<td>"+numeral(r[a].percent_employed).format("0.0")+"%</td>",t+="<td class='color-"+n+"'>"+numeral(s).format("0o")+"<div></div></td>"}t+="</tr>"}$("#occupations-table").html(t)}},{key:"drawPopulationData",value:function(){var e=this;google.setOnLoadCallback(function(){var t=new ApiController,a=e.params.regions.map(function(e){return t.getPopulationData(e.id)});Promise.all(a).then(function(t){e.drawMap(MapSources.population),e.drawPopulationChart(t),e.drawPopulationChangeChart(t)})["catch"](function(e){return console.error(e)})})}},{key:"drawPopulationChart",value:function(e){for(var t=[],a=["Year"],n=0;n<this.params.regions.length;n++)a[n+1]=this.params.regions[n].name;t.push(a);for(var r={},n=0;n<e.length;n++)for(var o=e[n],i=0;i<o.length;i++)void 0==r[o[i].year]&&(r[o[i].year]=[o[i].year]),r[o[i].year].push(parseInt(o[i].population));for(var s in r)t.push(r[s]);this.drawLineChart("population-chart",t,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Population"})}},{key:"drawPopulationChangeChart",value:function(e){for(var t=[],a=["Year"],n=0;n<this.params.regions.length;n++)a[n+1]=this.params.regions[n].name;t.push(a);for(var r={},n=0;n<e.length;n++)for(var o=e[n],i=0;i<o.length;i++)void 0==r[o[i].year]&&(r[o[i].year]=[o[i].year]),r[o[i].year].push(parseFloat(o[i].population_percent_change)/100);for(var s in r)t.push(r[s]);this.drawLineChart("population-change-chart",t,{curveType:"function",legend:{position:"bottom"},pointShape:"square",pointSize:8,title:"Population Change",vAxis:{format:"#.#%"}})}},{key:"drawPlacesInRegion",value:function(){if(0!=this.params.regions.length){var e=this.params.regions[0];switch(e.type){case"nation":this.drawChildPlacesInRegion(e,"Regions in {0}".format(e.name));break;case"region":this.drawChildPlacesInRegion(e,"Divisions in {0}".format(e.name));break;case"division":this.drawChildPlacesInRegion(e,"States in {0}".format(e.name));break;case"state":this.drawCitiesAndCountiesInState(e);break;case"county":this.drawOtherCountiesInState(e);break;case"msa":this.drawOtherMetrosInState(e);break;case"place":this.drawOtherCitiesInState(e)}}}},{key:"drawChildPlacesInRegion",value:function(e,t){var a=this,n=new ApiController;n.getChildRegions(e.id).then(function(e){a.drawPlacesInRegionHeader("#places-in-region-header-0",t),a.drawPlacesInRegionList("#places-in-region-list-0",e)})["catch"](function(e){return console.error(e)})}},{key:"drawCitiesAndCountiesInState",value:function(e){var t=this,a=new ApiController,n=a.getCitiesInState(e.id),r=a.getCountiesInState(e.id);return Promise.all([n,r]).then(function(a){0!=a.length&&(a[0].length>0&&(t.drawPlacesInRegionHeader("#places-in-region-header-0","Places in {0}".format(e.name)),t.drawPlacesInRegionList("#places-in-region-list-0",a[0])),a[1].length>0&&(t.drawPlacesInRegionHeader("#places-in-region-header-1","Counties in {0}".format(e.name)),t.drawPlacesInRegionList("#places-in-region-list-1",a[1])))})["catch"](function(e){return console.error(e)})}},{key:"drawOtherCitiesInState",value:function(e){var t=this,a=new ApiController;a.getParentState(e).then(function(e){if(0!=e.length){var n=e[0];a.getCitiesInState(n.parent_id).then(function(e){0!=e.length&&(t.drawPlacesInRegionHeader("#places-in-region-header-0","Places in {0}".format(n.parent_name)),t.drawPlacesInRegionList("#places-in-region-list-0",e))})["catch"](function(e){return console.error(e)})}})}},{key:"drawOtherCountiesInState",value:function(e){var t=this,a=new ApiController;a.getParentState(e).then(function(e){if(0!=e.length){var n=e[0];a.getCountiesInState(n.parent_id).then(function(e){0!=e.length&&(t.drawPlacesInRegionHeader("#places-in-region-header-0","Counties in {0}".format(n.parent_name)),t.drawPlacesInRegionList("#places-in-region-list-0",e))})["catch"](function(e){return console.error(e)})}})}},{key:"drawOtherMetrosInState",value:function(e){var t=this,a=new ApiController;a.getParentState(e).then(function(e){if(0!=e.length){var n=e[0];a.getMetrosInState(n.parent_id).then(function(e){0!=e.length&&(t.drawPlacesInRegionHeader("#places-in-region-header-0","Metropolitan Areas in {0}".format(n.parent_name)),t.drawPlacesInRegionList("#places-in-region-list-0",e))})["catch"](function(e){return console.error(e)})}})}},{key:"removeCurrentRegions",value:function(e){for(var t=arguments.length<=1||void 0===arguments[1]?5:arguments[1],a=0,n=[],r=0;r<e.length;r++)if(!this.isRegionIdContainedInCurrentRegions(e[r].child_id)){if(n.push(e[r]),a==t-1)break;a++}return n}},{key:"drawPlacesInRegionHeader",value:function(e,t){$(e).text(t).slideToggle(100)}},{key:"drawPlacesInRegionList",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?5:arguments[2];if(0!=t.length){for(var n=0,r="",o=0;o<t.length;o++)if(!this.isRegionIdContainedInCurrentRegions(t[o].child_id)){if(r+='<li><a href="',r+=this.getSearchPageForRegionsAndVectorUrl([t[o].child_id],[t[o].child_name])+'">',r+=t[o].child_name,r+="</a></li>",n==a-1)break;n++}$(e).html(r),$(e).slideToggle(100)}}},{key:"isRegionIdContainedInCurrentRegions",value:function(e){for(var t=0;t<this.params.regions.length;t++)if(e==this.params.regions[t].id)return!0;return!1}},{key:"drawSimilarRegions",value:function(e){var t=this;if(0!=this.params.regions.length){var a=this.params.regions[0],n=new ApiController;n.getSupportedVectors(a.id).then(function(e){return n.getSimilarRegions(a.id,e.available_vectors)}).then(function(a){return t.drawSimilarRegionsList(a,e)})["catch"](function(e){return console.error(e)})}}},{key:"drawSimilarRegionsList",value:function(e,t){var a=e.most_similar,n=a.map(function(e){return RegionLookup.byID(e.id)});Promise.all(n).then(function(e){var a=d3.select("#similar-regions");a.selectAll("li").data(e).enter().append("li").append("a").on("click",function(e){return t({id:e.id,name:e.name})}).text(function(e){return e.name}).append("i").attr("class","fa fa-plus");a.style("display","block")},function(e){throw e})}},{key:"drawLineChart",value:function(e,t,a){var n=google.visualization.arrayToDataTable(t),r=new google.visualization.LineChart(document.getElementById(e));this.applyStandardOptions(a),r.draw(n,a)}},{key:"drawSteppedAreaChart",value:function(e,t,a){var n=google.visualization.arrayToDataTable(t),r=new google.visualization.SteppedAreaChart(document.getElementById(e));this.applyStandardOptions(a),r.draw(n,a)}},{key:"applyStandardOptions",value:function(e){e.series={0:{color:"#2980b9"},1:{color:"#ee3b3b"},2:{color:"#3bdbee"},3:{color:"#ff9900"},4:{color:"#109618"}},e.legend={position:"top",maxLines:4,textStyle:{color:"#222",fontSize:14}}}},{key:"getRadiusScaleLinear",value:function(e){return d3.scale.linear().domain(d3.extent(e)).range(this.MAP_RADIUS_SCALE)}},{key:"getRadiusScaleLog",value:function(e){return d3.scale.log().domain(d3.extent(e)).range(this.MAP_RADIUS_SCALE)}},{key:"getColorScale",value:function(e){var t=this,a=function(){function a(t,a,r){return d3.quantile(e,(a+1)*n)}var n=1/t.MAP_COLOR_SCALE.length;return _.map(t.MAP_COLOR_SCALE.slice(1),a)}();return d3.scale.quantile().domain(a).range(this.MAP_COLOR_SCALE)}},{key:"drawCirclesForPlaces",value:function(e,t,a,n){t.forEach(function(t){var r={type:"Feature",properties:{name:t.name},geometry:{coordinates:t.coordinates,type:"Point"}},o={fillColor:n(t.value),fillOpacity:1,opacity:0,radius:8,stroke:!1,weight:0};L.geoJson(r,{pointToLayer:function(e,n){return L.circle(n,a(t.value),o)}}).addTo(e)})}},{key:"drawMarkersForPlaces",value:function(e,t){t.forEach(function(t){var a={type:"Feature",properties:{name:t.name},geometry:{coordinates:t.location.coordinates,type:"Point"}};L.geoJson(a).addTo(e)})}},{key:"getPlacesForRegion",value:function(e){var t=this,a=[];return e.forEach(function(e){t.params.regions.forEach(function(t){e.id==t.id&&a.push(e)})}),a}},{key:"fetchNextPage",value:function(){if(!this.fetching&&!this.fetchedAll){this.fetching=!0,this.incrementPage();var e=this;$.ajax(this.getSearchResultsUrl()).done(function(t,a,n){return 204==n.status?(e.decrementPage(),e.fetching=!1,void(e.fetchedAll=!0)):($(".datasets").append(t),void(e.fetching=!1))})}}},{key:"getSearchPageForRegionsAndVectorUrl",value:function(e,t,a,n,r){var o="";if(e&&e.length>0)if(o+="/region/"+e.join("-"),t&&t.length>0){var i=t.map(function(e){return e.replace(/ /g,"_").replace(/,/g,"")});o+="/"+i.join("-")}else o+="/-";else o+="/search";return a&&(o+="/"+a),n&&(o+="/search-results"),r&&(o+=r),o}},{key:"getSearchPageUrl",value:function(e){if(this.params.regions.length>0||this.params.autoSuggestedRegion){var t=[],a=[];return 0==this.params.resetRegions&&(t=this.params.regions.map(function(e){return e.id}),a=this.params.regions.map(function(e){return e.name})),this.params.autoSuggestedRegion&&(t.push(this.params.autoSuggestedRegion.id),a.push(this.params.autoSuggestedRegion.name)),this.getSearchPageForRegionsAndVectorUrl(t,a,this.params.vector,e,this.getSearchQueryString())}return this.getSearchPageForRegionsAndVectorUrl(null,null,this.params.vector,e,this.getSearchQueryString())}},{key:"getSearchResultsUrl",value:function(){return this.getSearchPageUrl(!0)}},{key:"getSearchQueryString",value:function(){var e=[];return this.params.q.length>0&&e.push("q="+encodeURIComponent(this.params.q)),this.params.page>1&&e.push("page="+this.params.page),this.params.categories.length>0&&e.push("categories="+encodeURIComponent(this.params.categories.join(","))),this.params.domains.length>0&&e.push("domains="+encodeURIComponent(this.params.domains.join(","))),this.params.tags.length>0&&e.push("tags="+encodeURIComponent(this.params.tags.join(","))),this.params.debug&&e.push("debug="),e.length>0?"?"+e.join("&"):""}},{key:"incrementPage",value:function(){this.params.page++}},{key:"navigate",value:function(){window.location.href=this.getSearchPageUrl()}},{key:"removeRegion",value:function(e){this.params.regions.splice(e,1),this.params.page=1}},{key:"setAutoSuggestedRegion",value:function(e,t){this.params.autoSuggestedRegion=e,this.params.resetRegions=t,this.params.page=1}},{key:"toggleCategory",value:function(e){var t=this.params.categories.indexOf(e);t>-1?this.params.categories.splice(t,1):this.params.categories.push(e),this.params.page=1}},{key:"toggleDomain",value:function(e){var t=this.params.domains.indexOf(e);t>-1?this.params.domains.splice(t,1):this.params.domains.push(e),this.params.page=1}},{key:"toggleTag",value:function(e){var t=this.params.tags.indexOf(e);t>-1?this.params.tags.splice(t,1):this.params.tags.push(e),this.params.page=1,this.params.categories=[],this.params.domains=[],this.params.q="",this.params.regions=[],this.params.vector=""}}]),e}();$(document).ready(function(){var e=new SearchPageController(_params);if(multiComplete("#q",".region-list").listen(),$(".fa-close").click(function(){$(".current-category").fadeOut()}),_params.regions.length>0)switch(_params.vector){case"population":e.drawPopulationData();break;case"earnings":e.drawEarningsData();break;case"health":e.drawHealthData(),jQuery("#cdc-brfss-overall-health-chart-selector").on("change",function(){e.drawBrfssCharts()});break;case"education":e.drawEducationData();break;case"occupations":e.drawOccupationsData();break;case"cost_of_living":e.drawCostOfLivingData();break;case"gdp":e.drawGdpData();break;default:e.drawPopulationData()}});
//# sourceMappingURL=search.min.js.map
